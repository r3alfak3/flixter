<script>
  $(function() {
    $('.lessons').sortable({
	    update: function( event, ui ) {
	    	$.ajax({
	    		type: 'PUT',
				  beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
	    		url: ui.item.data('update-url'),
	    		dataType: 'json',
	    		data: { lesson: { row_order_position: ui.item.index() } }
	    	});
	    }
  	});
  });

  $(function() {
    $('.sections').sortable({
      update: function( event, ui ) {
        $.ajax({
          type: 'PUT',
				  beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
          url: ui.item.data('update-url'),
          dataType: 'json',
          data: { section: { row_order_position: ui.item.index() } }
        });
      }
    });
  });

	$(function () {
$('#example').tooltip(options)
	});

</script>

<div class="booch-box col-10 offset-1 p-4 my-5 off-white-b bs">
	<h1 class="text-center fer-blk brownish-f tsa"><%= current_course.title %> <span class="badge badge-default off-white-f green-b"><%= number_to_currency current_course.cost %></span></h1>
	<div class="container">
	  <div class="row">
	    <div class="col text-center mt-3 mb-4">
	    	<button type="button" class="btn btn-md btn-primary brownish-b off-white-f" data-toggle="modal" data-target="#newSectionModal">
 				 <i class="fas fa-plus-circle"></i> Launch demo modal
				</button>
					<%= link_to course_path(current_course), class: 'btn btn-primary btn-large brownish-b off-white-f droid' do %>
						<i class="fas fa-glasses"></i>
						Preview
					<% end %>
	    </div>
		<div class="row">
			<div class="col-md-6 col-12">
				<% if current_course.image.url.present? %>
					<%= image_tag current_course.image.url, class: 'img-fluid text-center round-img' %>
				<% else %>
					<%= image_tag 'default.jpg', class: 'img-fluid text-center round-img' %>
				<% end %>
			</div>
			<div class="col-md-6 col-12">
				<p class="droid"><%= current_course.description %></p>
			</div>					
		</div>
	  </div>
		<div class="col-md-6 offset-md-3 col-12 offset-0 ">
			<% if current_course.sections.present? %>
				<h5 class="brownish-f mt-4 droid text-center">Drag & Drop to reorder Sections or Lessons</h5>
			<% end %>
			<ul class="sections">
				<% current_course.sections.rank(:row_order).each do |section| %>
					<li  data-update-url="<%= instructor_section_path(section) %>">
						<div class="row">
							<div class="col-12 adminDD pt-1" ><h4 class="brownish-f"><span class="align-middle"><i class="fas fa-ellipsis-v"></i> <%= section.title %></span>
							<% if current_user && current_user == current_course.user %>
						  	<%= link_to new_instructor_section_lesson_path(section), class: 'btn btn-primary brownish-b btn-sm off-white-f droid float-right' do %>
									<i class="fas fa-plus-circle"></i>
									Lesson
								<% end %>
							<% end %>
							</h4>
							</div>
						</div>
						<ul class="lessons list-group col-12">
							<% section.lessons.rank(:row_order).each do |lesson| %>
								<li data-update-url="<%= instructor_lesson_path(lesson) %>">
									<div class=" col-12 brownish-b text-center bs p-2 mx-auto btn mb-4 lessonDD">
										<span class="cream-f tsa"><i class="fas fa-ellipsis-h"></i></span>
									  <%= link_to lesson_path(lesson) do %>
											<h5 class="off-white-f tsa"><b><%= lesson.title %></b></h5>
										<% end %>
										<div class="cream-b h-auto p-2">
									  	<p class="droid-bi"><%= lesson.subtitle %></p>
									  </div>
									</div>
								</li>
					 	  <% end %>
						</ul>
					</li>
				<% end %>
			</ul>
		</div>
	</div>
</div>

<!-- Modal -->
<div class="modal fade" id="newSectionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">Ã—</span>
        </button>
        <h4 class="modal-title" id="newSectionModalLabel">Add a New Section</h4>
      </div>
			<%= simple_form_for @section, url: instructor_course_sections_path(current_course) do |f| %>
      <div class="modal-body">
				<%= f.input :title %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn cream-b" data-dismiss="modal">Close</button>
				<%= f.submit "ADD SECTION", class: 'btn btn-primary brownish-b' %>
				<% end %>
      </div>
    </div>
  </div>
</div>